<!DOCTYPE html>
<html>
    <head>
        <title>Capture The Glag Game!</title> 
        <style>
            #canvas {
                border: 1px solid black;
                background-color: whitesmoke;
            }
            #timer {
                font-size: 30px;
                text-align: left;
                color: red;
                text-emphasis: bold;
                font-family: Arial, Helvetica, sans-serif;
                width: 100px;
                height: 30px;
                background-color: black;
            }      
            #timeText {
                font-size: 10px;
                text-align: left;
                color: black;
                text-emphasis: bold;
                font-family: Arial, Helvetica, sans-serif;
                height: 10px;
            }      
        </style>
    </head>
    <body style= "background-color: #B0C4DE";>
        <p id="timeText">Miliseconds left in game: </p>
        <div id="timer">
                300000
        </div>
        <canvas id="canvas" ></canvas>
        <script>
            (function() {
                var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
                window.requestAnimationFrame = requestAnimationFrame;
            })();
    
            //variables
            //var player;
            var pwidth = 5;
            var pheight = 5;
            var PlayerXstartX = 26;
            var PlayerXstartY = 234;
            var PlayerYstartX = 26;
            var PlayerYstartY = 929;
            var px;
            var py;
            //Eventually take this out
            px = PlayerXstartX;
            py = PlayerXstartY;
            //
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");

            var width = 960;
            var height = 640;

            canvas.width = width;
            canvas.height = height;

            var keys = [];

            var gravity = 1;
            var jumping = false;


            var xTeamSize;
            var yTeamSize;

            var xScoreLabel; //Text value
            var yScoreLabel; //Text value

            var xTeamScore = 0; //Int value
            var yTeamScore = 0; //Int value

            //must be sent to false to begin only true now to test code
            var isPlayerX = true;
            var isPlayerY = false;
            var playerColour;
            var Xcolour = "red";
            var Ycolour = "blue";
            var onPlatform = false;
            flagCarryingByX = false;
            flagCarryingByY = false;
            var playerSpeed;
            var jumpSpeed = 4;

            /*
            function startGame() {
                xScoreLabel = new component("30px", "Consolas", "black", 10, 10, "text");
                yScoreLabel = new component("30px", "Consolas", "black", 760, 10, "text");

                update();
            }
            
            function createPlayers() {
                if ((xTeamSize < 3) && (xTeamSize != 3)) {
                    //The player will be xTeam
                    xTeamSize = xTeamSize + 1;
                    PlayerXstartY = PlayerXstartY + 6;
                    isPlayerX = true;
                    createPlayer();
                } else if ((yTeamSize < 3) && (yTeamSize != 3)) {
                    //The player will be yTeam
                    yTeamSize = yTeamSize + 1;
                    PlayerYstartY = PlayerYstartY - 6;
                    isPlayerY = true;
                    createPlayer();
                } else if ((xTeamSize == 3) && (yTeamSize == 3)) {
                    //The teams are full stop calling this function and adding players
                    update();
                }
            }
            function createPlayer() {
                if (isPlayerX) {
                    playerColour = Xcolour;
                    px = PlayerXstartX;
                    py = PlayerXstartY;
                } else if (isPlayerY) {
                    playerColour = Ycolour;
                    px = PlayerYstartX;
                    py = PlayerYstartY;
                }
            }
            */
            var platforms = {
                start : function() {
                    //making the platforms
                    //red team starting point and red flag start point
                    //ctx.beginPath();
                    ctx.fillStyle = "red";
                    ctx.fillRect(0,240,100,10);
                    //Flag
                    if (!flagCarryingByY) {
                        ctx.fillRect(10,209,10,30);
                    }
                    //blue team starting point and blue flag start point
                    ctx.fillStyle = "blue";
                    ctx.fillRect(860,240,100,10);
                    //Flag
                    if (!flagCarryingByX) {
                        ctx.fillRect(940,209,10,30);
                    }
                    //Making the platforms
                    ctx.fillStyle = "black";
                    ctx.fillRect(140,340,75,10); 
                    ctx.fillRect(745,340,75,10); 
                    ctx.fillRect(0,540,75,10); 
                    ctx.fillRect(885,540,75,10); 
                    ctx.fillRect(442.5,490,75,10); 
                    ctx.fillRect(442.5,340,75,10); 
                    ctx.fillRect(140,440,75,10); 
                    ctx.fillRect(745,440,75,10); 
                    ctx.fillRect(291.25,390,75,10); 
                    ctx.fillRect(593.75,390,75,10);
                    //Floor of the canvas 
                    //return player to start position if they hit this
                    ctx.fillStyle = "orange";
                    ctx.fillRect(0,630,960,10);
                }
            }
            
            var time = 300000;
            function timer() {
                setTimeout(function(){
                    var timerDiv = document.getElementById("timer");
                    time = time-1;
                    timerDiv.innerHTML = time;
                    //timer();
                }, 1000)
            }
            function checkTime() {
                if (time <= 0) {
                    time = 0;
                    //end game
                }
            }
            function isCarryingFlagplayerOnPlatform() {
                //red base
                if (((px>=0)&&(px<=100))&&((py>=209)&&(py<=250))) { //ctx.fillRect(0,240,100,10);
                    jumping = false;
                    py = 209;
                    onPlatform = true;
                    updateScore();
                }
                //blue base
                else if (((px>=860)&&(px<=960))&&((py>=209)&&(py<=250))) { //ctx.fillRect(860,240,100,10);
                    jumping = false;
                    py = 209;
                    onPlatform = true;
                    updateScore();
                }
                //black platforms
                else if (((px>=140)&&(px<=215))&&((py>=309)&&(py<=350))) { //ctx.fillRect(140,340,75,10);
                    jumping = false;
                    py = 309;
                    onPlatform = true;
                } else if (((px>=745)&&(px<=820))&&((py>=309)&&(py<=350))) { //ctx.fillRect(745,340,75,10);
                    jumping = false;
                    py = 309;
                    onPlatform = true;
                } else if (((px>=0)&&(px<=75))&&((py>=509)&&(py<=550))) { //ctx.fillRect(0,540,75,10);
                    jumping = false;
                    py = 509;
                    onPlatform = true;
                } else if (((px>=885)&&(px<=960))&&((py>=509)&&(py<=550))) { //ctx.fillRect(885,540,75,10);
                    jumping = false;
                    py = 509;
                    onPlatform = true;
                } else if (((px>=442.5)&&(px<=517.5))&&((py>=459)&&(py<=500))) { //ctx.fillRect(442.5,490,75,10);
                    jumping = false;
                    py = 459;
                    onPlatform = true;
                } else if (((px>=442.5)&&(px<=517.5))&&((py>=309)&&(py<=350))) { //ctx.fillRect(442.5,340,75,10);
                    jumping = false;
                    py = 309;
                    onPlatform = true;
                } else if (((px>=140)&&(px<=215))&&((py>=409)&&(py<=450))) { //ctx.fillRect(140,440,75,10);
                    jumping = false;
                    py = 409;
                    onPlatform = true;
                } else if (((px>=745)&&(px<=820))&&((py>=409)&&(py<=450))) { //ctx.fillRect(745,440,75,10);
                    jumping = false;
                    py = 409;
                    onPlatform = true;
                } else if (((px>=291.25)&&(px<=366.25))&&((py>=359)&&(py<=400))) { //ctx.fillRect(291.25,390,75,10);
                    jumping = false;
                    py = 359;
                    onPlatform = true;
                } else if (((px>=593.75)&&(px<=668.75))&&((py>=359)&&(py<=400))) { //ctx.fillRect(593.75,390,75,10);
                    jumping = false;
                    py = 359;
                    onPlatform = true;
                } else {
                    onPlatform = false;
                }
            }
            function isPlayerOnPlatform() {
                //red base
                if (((px>=0)&&(px<=100))&&((py>=234)&&(py<=250))) { //ctx.fillRect(0,240,100,10);
                    jumping = false;
                    py = 234;
                    onPlatform = true;
                    if (isPlayerY) {
                        flagCarryingByY = true;
                        py = 209;
                        pwidth = 10;
                        pheight = 30;
                    }
                }
                //blue base
                else if (((px>=860)&&(px<=960))&&((py>=234)&&(py<=250))) { //ctx.fillRect(860,240,100,10);
                    jumping = false;
                    py = 234;
                    onPlatform = true;
                    if (isPlayerX) {
                        flagCarryingByX = true;
                        py = 209;
                        pwidth = 10;
                        pheight = 30;
                    } 
                }
                //black platforms
                else if (((px>=140)&&(px<=215))&&((py>=334)&&(py<=350))) { //ctx.fillRect(140,340,75,10);
                    jumping = false;
                    py = 334;
                    onPlatform = true;
                } else if (((px>=745)&&(px<=820))&&((py>=334)&&(py<=350))) { //ctx.fillRect(745,340,75,10);
                    jumping = false;
                    py = 334;
                    onPlatform = true;
                } else if (((px>=0)&&(px<=75))&&((py>=534)&&(py<=550))) { //ctx.fillRect(0,540,75,10);
                    jumping = false;
                    py = 534;
                    onPlatform = true;
                } else if (((px>=885)&&(px<=960))&&((py>=534)&&(py<=550))) { //ctx.fillRect(885,540,75,10);
                    jumping = false;
                    py = 534;
                    onPlatform = true;
                } else if (((px>=442.5)&&(px<=517.5))&&((py>=484)&&(py<=500))) { //ctx.fillRect(442.5,490,75,10);
                    jumping = false;
                    py = 484;
                    onPlatform = true;
                } else if (((px>=442.5)&&(px<=517.5))&&((py>=334)&&(py<=350))) { //ctx.fillRect(442.5,340,75,10);
                    jumping = false;
                    py = 334;
                    onPlatform = true;
                } else if (((px>=140)&&(px<=215))&&((py>=434)&&(py<=450))) { //ctx.fillRect(140,440,75,10);
                    jumping = false;
                    py = 434;
                    onPlatform = true;
                } else if (((px>=745)&&(px<=820))&&((py>=434)&&(py<=450))) { //ctx.fillRect(745,440,75,10);
                    jumping = false;
                    py = 434;
                    onPlatform = true;
                } else if (((px>=291.25)&&(px<=366.25))&&((py>=384)&&(py<=400))) { //ctx.fillRect(291.25,390,75,10);
                    jumping = false;
                    py = 384;
                    onPlatform = true;
                } else if (((px>=593.75)&&(px<=668.75))&&((py>=384)&&(py<=400))) { //ctx.fillRect(593.75,390,75,10);
                    jumping = false;
                    py = 384;
                    onPlatform = true;
                } else {
                    onPlatform = false;
                }
            }
            
            function playerOnPlatform() {
                if (flagCarryingByX || flagCarryingByY) {
                    isCarryingFlagplayerOnPlatform();
                } else {
                    isPlayerOnPlatform();
                }
            }

            function updatePlayer() {
                //player size
                if (isPlayerX) {
                    if (flagCarryingByX) {
                        pwidth = 10;
                        pheight = 30;
                    }
                } else if (isPlayerY) {
                    if (flagCarryingByY) {
                        pwidth = 10;
                        pheight = 30;
                    }
                } else {
                    px = 5;
                    pw = 5
                }
                //player colour
                if (isPlayerX && flagCarryingByX) {
                    Xcolour = "blue";
                } else if (isPlayerY && flagCarryingByY) {
                    Ycolour = "red";
                }
            }

            function updateScore() {
                if (isPlayerX && flagCarryingByX) {
                    xTeamScore = xTeamScore + 1;
                    pwidth = 5;
                    pheight = 5;
                    colour = "red"
                } 
                else if (isPlayerY && flagCarryingByY) {
                    yTeamScore = yTeamScore + 1;
                    pwidth = 5;
                    pheight = 5;
                    colour = "blue"
                }
            }

            function jump() {
                if (onPlatform) {
                    py = py -140;
                    updatePlayer();
                }
            }
            //game functionallity
            function update() {
                timer();
                // check keys
                if (keys[38]) {
                    // up arrow
                    if (onPlatform) {
                        jump();
                        jumping = true;
                    }
                }
                if (keys[39]) {
                    // right arrow
                    px = px + 1;
                    updatePlayer();
                    jumping = true;
                    playerOnPlatform();
                }                              
                if (keys[37]) { 
                    //left arrow
                    px = px -1;
                    updatePlayer();
                    jumping = true;
                    playerOnPlatform();
                }
                if (jumping) {
                    playerOnPlatform();
                    py = py + gravity;
                }
              
                //Staying in the game canvas
                if (px >= width-pwidth) {
                    px = width- pwidth;
                } else if (px <= 0) {         
                    px = 0;     
                } else if(((px>=0)&&(px<=960))&&(py>=624)){ //ctx.fillRect(0,630,960,10);
                    if (isPlayerX) {
                        px = PlayerXstartX;
                        py = PlayerXstartY;
                    } else if (isPlayerY) {
                        px = PlayerYstartX;
                        py = PlayerYstartY;
                    }
                //The floor is lava
                } else if(flagCarryingByX || flagCarryingByY){ //ctx.fillRect(0,630,960,10);
                    if (((px>=0)&&(px<=960))&&(py>=599)){
                        if (isPlayerX) {
                            flagCarryingByX = false;
                            pheight = 5;
                            pwidth = 5;
                            px = PlayerXstartX;
                            py = PlayerXstartY;
                            Xcolour = "red";
                        } else if (isPlayerY) {
                            flagCarryingByY = false;
                            pheight = 5;
                            pwidth = 5;
                            px = PlayerYstartX;
                            py = PlayerYstartY;
                            Ycolour = "blue";
                        }
                    }
                } else if (py <=0){
                    py = 0;
                }
                updatePlayer();
                playerOnPlatform();
                ctx.clearRect(0,0,width,height);

                var colour;
                if (isPlayerX) {
                    colour = Xcolour;
                } else if (isPlayerY) {
                    colour = Ycolour;
                }
                ctx.fillStyle = colour;
                ctx.fillRect(px, py, pwidth, pheight);
                platforms.start();

                xScoreLabel.text = "X Team Score: " + xTeamScore;
                yScoreLabel.text = "Y Team Score: " + yTeamScore;

                requestAnimationFrame(update);
            }
            
            document.body.addEventListener("keydown", function(e) {
                keys[e.keyCode] = true;
            });
 
            document.body.addEventListener("keyup", function(e) {
                keys[e.keyCode] = false;
            });    
                
            window.addEventListener("load", function(){
                //createPlayers();
                update();
            });   
                
        </script>
    <h4 style="font-family: Arial, Helvetica, sans-serif; font-size: 15px;">My Team Score:
    <script type="text/javascript">document.write(xTeamScore)</script> </h4> 
            
    <h4 style="font-family: Arial, Helvetica, sans-serif; font-size: 15px;">Opponent Team Score: 
    <script type="text/javascript">document.write(yTeamScore)</script></h4>
    <p> </p>
    <p style="font-family: Arial, Helvetica, sans-serif; font-size: 12px;">Game Instructions:</p>
    <p style="font-family: Arial, Helvetica, sans-serif; font-size: 10px;">up arrow to jump</p>
    <p style="font-family: Arial, Helvetica, sans-serif; font-size: 10px;">left right arrows to move left and right</p>
    <p style="font-family: Arial, Helvetica, sans-serif; font-size: 10px;">space to freeze other players</p>
    </body>
</html>
